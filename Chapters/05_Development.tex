\chapter{Development}

The web application is designed, 
with the frontend responsible for collecting user data and presenting recommendations and explanations, 
while the backend handles the database generated by the FLEX models. 


\section{Frontend}

The frontend of the web application is responsible for creating an engaging and user-friendly interface using HTML, CSS, and JavaScript. 
They were used to structure the content, define the visual styles, and add interactivity to the application.
HTML is used to create the structure of the webpages, CSS is employed to style the visual appearance of the application. 
JavaScript plays a crucial role in adding interactivity and dynamic functionality to the web application. 
Additionally, JavaScript is responsible for making asynchronous requests to the server, facilitating communication with the backend.
To ensure a responsive design, the web application utilises the Bootstrap framework. 
Although the service is not intended for mobile screens, a responsive user interface that adapts to various devices and screen sizes has been taken into account. 


\subsection{Questionnaire}

To incorporate questionnaires into the web application, we integrated SurveyJS, an open-source JavaScript form builder library \cite{surveyjs}. 
SurveyJS simplifies the process of creating and embedding surveys.
It supports logic and branching, allowing for dynamic survey behaviour based on user responses, 
that fulfils our need of presenting corresponding questions according to the answers, as decribed in the design section. 


\subsection{Charts}

For chart building, we initially opted for Google Charts, a charting library provided by Google \cite{googlecharts}. 
However, we encountered difficulties in building multiple columns using Google Charts. 
As a result, we switched to Highcharts \cite{highcharts}, another powerful charting library written in JavaScript. 


\section{Backend}

The backend of the web application utilises Flask, a Python-based web framework \cite{flask}, to serve as the intermediary between the frontend and the FLEX models. 
This choice was made based on the fact that the FLEX models are implemented in Python. 
Originally, our intention was to enable direct communication between the backend and the models using Python. 
However, during the development process, we realised that the models' calculations, especially when finding recommended configurations, could be time-consuming. 
Each scenario takes approximately seven seconds to calculate, and considering the need to identify multiple scenarios that could save energy costs for the household, 
it would be impractical to make the user wait for the results. 
To address this issue, we decided to pre-process the data in the FLEX models and store it in a database. 
This approach significantly reduced the time required to identify energy-saving scenarios, allowing for a more efficient user experience.
Once again, I would like to express my sincere gratitude to Raphael Schlarb for his assistance in programming the backend for this service 
and for providing guidance on the 'Backend' chapter. 


\subsection{API}

The API uses the HTTP protocol and follows a RESTful architecture. 
It provides a set of endpoints that allow users to communicate, via JSON objects,
with the recommendation system.
The api consists of four endpoint: \textbf{scenario}, \textbf{recommendation}, \textbf{energy\_data}, and \textbf{energy\_cost}.
For each endpoint, there is one of two HTTP methods available: \textbf{GET} and \textbf{POST}.

The following sections describe the endpoints and their properties in more detail.


\subsubsection{Scenario}

The \textbf{scenario} endpoint is used via a \textbf{POST} method to send a \textbf{scenario configration} to the recommendation system
and receive a unique \textbf{scenario id} in return. A scenario configuration is a JSON object that describes the house and it's energy system
(see table \ref{tab:properties_config}). The \textbf{scenario id} is an integer that uniquely identifies the scenario.
\begin{table}[h!]
    \centering
    \small
    \begin{tabular}{ | p{.15\textwidth} | p{.15\textwidth} | p{.35\textwidth} | p{.10\textwidth} | } 
    \hline
    Name & Type & Description & Optional \\
    \hline
    battery & object & JSON object describing the installed battery & Yes \\
    \hline
    building & object & JSON object describing the building & No \\
    \hline
    pv & object & JSON object describing the installed PV & Yes \\
    \hline
    boiler & object & JSON object describing the installed boiler & Yes \\
    \hline 
    region & object & JSON object describing the region & No \\
    \hline
    \end{tabular}
    \caption{Scenario configuration}
    \label{tab:properties_config}
\end{table}


\subsubsection{Recommendation}

By sending a \textbf{GET} request to the \textbf{recommendation} endpoint with a \textbf{scenario id} as a parameter,
the user can retrieve a list of recommended configurations and their associated costs.
The schema of an entry in the list is described in table \ref{tab:properties_recommendation_endpoint}.

\begin{table}[h!]
    \centering
    \small
    \begin{tabular}{ | p{.15\textwidth} | p{.15\textwidth} | p{.45\textwidth} | } 
    \hline
    Name & Type & Description \\
    \hline
    config & object & A scenario configuration as described in table \ref{tab:properties_config}. \\
    \hline
    type & string & Recommendation type. Can be either "Lowest Energy Bill", "Lowest Investment", "Cost Benefit". \\
    \hline
    yearly\_bill & integer & The yearly energy bill for the recommended configuration. \\
    \hline
    investment\_cost & integer & The annualised investment cost for the recommended configuration. \\
    \hline
    \end{tabular}
    \caption{Recommendation entry}
    \label{tab:properties_recommendation_endpoint}
\end{table}


\subsubsection{Energy data}

The energy\_data property contains data related to energy demand and PV generation (See table \ref{tab:properties_energydata}).  
By sending a \textbf{GET} request to the \textbf{energy\_data} endpoint with a \textbf{scenario id} as a parameter,
the user can retrieve the energy\_data for the scenario.

\begin{table}[h!]
    \centering
    \small
    \begin{tabular}{ | p{.20\textwidth} | p{.10\textwidth} | p{.40\textwidth} | } 
    \hline
    Name & Type & Description\\
    \hline
    total\_demand & integer & The total energy demand in a year.\\
    \hline
    total\_generate & integer & The total energy generated by PV in a year.\\
    \hline
    boiler & array & The energy demanded for heating in the house for each month.\\
    \hline
    cooling & array & The energy demanded for cooling in the house for each month.\\
    \hline
    appliance & array & The energy demanded by all appliances in the house for each month.\\
    \hline
    hotwater & array & The energy demanded for hot water in the house for each month.\\
    \hline
    pv & integer & The energy generated from PV in the house for each month.\\
    \hline
    \end{tabular}
    \caption{Properties of energy\_data}
    \label{tab:properties_energydata}
\end{table}


\subsubsection{Energy cost}

The energy\_cost property contains data related to energy cost (See table \ref{tab:properties_energycost})
and can be retrieved by sending a \textbf{GET} request to the \textbf{energy\_cost} endpoint with a \textbf{scenario id} as a parameter.

\begin{table}[h!]
    \centering
    \small
    \begin{tabular}{ | p{.20\textwidth} | p{.10\textwidth} | p{.40\textwidth} | } 
    \hline
    Name & Type & Description\\
    \hline
    yearly\_bill & integer & The total energy cost in a year.\\
    \hline
    \end{tabular}
    \caption{Properties of energy\_cost}
    \label{tab:properties_energycost}
\end{table}


\subsection{Usage}

A user can interact with the API by sending HTTP requests to the endpoints described above.
The usual workflow is as follows:

In the initial step the user sends a \textbf{POST} request to the \textbf{scenario} endpoint with a \textbf{scenario configuration} as a parameter
and receives a \textbf{scenario id} in return.
Then, the user sends a \textbf{GET} request to the \textbf{recommendation}, \textbf{energy\_data}, or \textbf{energy\_cost} endpoint with the \textbf{scenario id} as a parameter
to retrieve the desired data.

Presently, the web service is accessible to all users via \url{http://flex-model.org:8080/}. 
While the service is currently tailored for users in Germany, there are future plans to extend its coverage to various other European countries. 